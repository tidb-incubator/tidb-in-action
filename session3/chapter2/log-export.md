# 2.4 日志搜索和导出

上一节介绍如何操作生成集群诊断报告。

本节将介绍如何使用 TiDB Dashboard 分析 TiDB 系统日志。

日志搜索功能允许用户在集群中搜索所有节点上的日志，在页面上预览搜索结果和导出日志。

## 1. 日志搜索功能

日志搜索主要是根据用户设置，对服务器上的日志内容进行筛选。

可设置参数包括:

- 时间范围：限定搜索日志的时间范围，为空的话默认搜索所有日志
- 日志等级：限定 ​ 最低日志等级 ​，搜索该日志等级以上的所有日志
- 组件：选择要搜索的集群组件。支持选择多个组件
- 关键词：任何合法的任何字符串。选填，关键词之间以空格分割，支持 regex

点击「日志搜索」按钮后，会进入下面详情页面，如下图：

![](/res/session3/chapter2/log-export/1.jpg)

## 2. 日志搜索进度


搜索进度在左边栏中，可以展示当前搜索的进度、状态以及每个节点日志搜索状态和统计等，搜索进度中还包括下载日志功能，见下小节图。展示状态示例：

- 运行中：开始搜索后，所有任务会进入「运行中」状态
- 成功：任务完成后自动转到「成功」，此时日志已缓存在 Dashboard 后端所在的本地磁盘中，可以提供给前端下载
- 失败：用户主动取消，或者某种原因报错退出的任务进入「失败」状态。任务失败时会自动清理本地临时文件

包含三个控制按钮：

- 下载选中日志：下载被勾选组件的日志(只有已完成的才能被勾选)
- Cancel：​ 取消所有正在运行的任务 ​，只能在有运行中的任务时才能点击
- Retry：重试所有失败的任务 ​，只有在有失败任务且无正在运行的任务时才能点击

## 3. 日志搜索结果

日志搜索结果展示各个节点的日志信息。

主要包括以下 4 项信息：

- 时间：日志产生的时间，时区与前端用户所处时区相同
- 日志等级：日志 WARN、ERROR 等日志等级
- 组件类型：显示组件名称，目前主要有 TiDB、TiKV、PD
- 日志：每条日志记录的正文部分，不包含日志的时间和日志等级。过长的日志，会自动截断，鼠标悬停可以查看完整的日志，完整日志最长显示 512 个字符。如下图：

![](/res/session3/chapter2/log-export/2.jpg)

## 4. 日志导出功能

搜索结果可以在右边栏中看到日志下载功能，用户可以选择要下载的组件日志。

点击「下载选中日志」按钮，自动下载日志压缩包到本地，供用户分析查看，如下图：

![](/res/session3/chapter2/log-export/3.jpg)

- 当选择一个组件时会返回 zip 文件，解压得到 log 文本文件
- 当选择多个组件时会返回 tar 文件，解压得到多个 zip 文件，解压 zip 得到 log 文本文件
